{"version":3,"sources":["../library.js"],"names":["$","mySpires","prepare","then","tag","val","trim","length","html","tagEx","split","subtitleLink","subtitle","t","removeClass","toggleClass","click","i","lastIndexOf","window","location","substring","subtags","jQuery","map","taglist","indexOf","s","substr","grep","hide","subtag","tagopts","subtagBox","loadSubtag","tagShow","remove","$spinner","show","records","keys","Object","sort","a","b","updated","Date","trigger","setInterval","entry","mySpires_Box","box","fadeIn","undefined","clearInterval","entryTagsAuthors","select2","placeholder","containerCssClass","data","concat","authorShow","replace","author","change","sortPapers","console","log","method","order","attr","entryBox","modifiedDate","appendTo","publishedDate"],"mappings":";;AAAA;;AAEAA,EAAE,YAAW;AACTC,aAASC,OAAT,GAAmBC,IAAnB,CAAwB,YAAW;AAC/B,YAAIC,MAAMJ,EAAE,cAAF,EAAkBK,GAAlB,EAAV;;AAEA,YAAGD,IAAIE,IAAJ,GAAWC,MAAX,KAAsB,CAAzB,EAA4B;AACxBH,kBAAM,UAAN;AACAJ,cAAE,cAAF,EAAkBK,GAAlB,CAAsBD,GAAtB;AACH;;AAED,YAAGA,QAAQ,UAAX,EAAuB;AACnBJ,cAAE,gBAAF,EAAoBQ,IAApB,CAAyB,SAAzB;AACH,SAFD,MAGK;AACD,gBAAIC,QAAQL,IAAIM,KAAJ,CAAU,GAAV,CAAZ;;AAEA,gBAAIC,eAAe,EAAnB;AACA,gBAAIC,WAAW,yBAAf;AAJC;AAAA;AAAA;;AAAA;AAKD,qCAAaH,KAAb,8HAAoB;AAAA,wBAAZI,CAAY;;AAChB,wBAAGF,iBAAiB,EAApB,EAAwBA,eAAeA,eAAe,GAA9B;AACxBA,mCAAeA,eAAeE,CAA9B;AACAD,+BAAWA,WAAW,mBAAX,GAAiCD,YAAjC,GAAgD,IAAhD,GAAuDE,CAAvD,GAA2D,MAAtE;AACH;AATA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAWDb,cAAE,aAAF,EAAiBc,WAAjB,CAA6B,YAA7B;AACAd,cAAE,gBAAF,EAAoBQ,IAApB,CAAyBC,MAAMA,MAAMF,MAAN,GAAe,CAArB,CAAzB;AACAP,cAAE,kBAAF,EAAsBQ,IAAtB,CAA2BI,QAA3B;;AAEAZ,cAAE,mBAAF,EAAuBe,WAAvB,CAAmC,0BAAnC,EAA+DC,KAA/D,CAAqE,YAAW;AAC5E,oBAAIC,IAAIb,IAAIc,WAAJ,CAAgB,GAAhB,CAAR;AACA,wBAAOD,CAAP;AACI,yBAAK,CAAC,CAAN;AACIE,+BAAOC,QAAP,GAAkB,GAAlB;AACA;AACJ;AACID,+BAAOC,QAAP,GAAkBD,OAAOC,QAAP,GAAkB,UAAUhB,IAAIiB,SAAJ,CAAc,CAAd,EAAiBJ,CAAjB,CAA9C;AALR;AAOH,aATD;AAUH;;AAED,YAAIK,UAAUC,OAAOC,GAAP,CAAWvB,SAASwB,OAApB,EAA6B,UAASZ,CAAT,EAAY;AACnD,gBAAGT,QAAQ,UAAX,EAAuB;AACnB,oBAAGS,EAAEP,IAAF,GAASC,MAAT,KAAoB,CAAvB,EAA0B,OAAOM,EAAEH,KAAF,CAAQ,GAAR,EAAa,CAAb,CAAP,CAA1B,KACK,OAAO,KAAP;AACR,aAHD,MAGO,IAAGG,EAAEa,OAAF,CAAUtB,MAAM,GAAhB,MAAyB,CAA5B,EAA+B;AAClC,oBAAIuB,IAAId,EAAEe,MAAF,CAASxB,IAAIG,MAAJ,GAAa,CAAtB,CAAR;AACA,uBAAOH,MAAM,GAAN,GAAYuB,EAAEjB,KAAF,CAAQ,GAAR,EAAa,CAAb,CAAnB;AACH,aAHM,MAGA;AACH,uBAAO,KAAP;AACH;AACJ,SAVa,CAAd;;AAYAY,kBAAUC,OAAOM,IAAP,CAAYP,OAAZ,EAAqB,UAAST,CAAT,EAAYI,CAAZ,EAAe;AAC1C,gBAAGJ,MAAM,KAAN,IAAeS,QAAQI,OAAR,CAAgBb,CAAhB,MAAuBI,CAAzC,EAA4C,OAAO,IAAP;AAC/C,SAFS,CAAV;;AAIA,YAAGK,QAAQf,MAAR,KAAmB,CAAtB,EAAyBP,EAAE,uBAAF,EAA2B8B,IAA3B,GAAzB,KACK,IAAG1B,QAAQ,UAAX,EAAuBJ,EAAE,0BAAF,EAA8BQ,IAA9B,CAAmC,WAAWc,QAAQf,MAAnB,GAA4B,GAA/D,EAAvB,KACAP,EAAE,0BAAF,EAA8BQ,IAA9B,CAAmC,cAAcc,QAAQf,MAAtB,GAA+B,GAAlE;;AAEL,aAAI,IAAIU,CAAR,IAAaK,OAAb,EAAsB;AAClB,gBAAIS,SAAST,QAAQL,CAAR,CAAb;;AAEA,gBAAGhB,SAAS+B,OAAT,CAAiBD,MAAjB,KAA4B9B,SAAS+B,OAAT,CAAiBD,MAAjB,EAAyB,MAAzB,CAA/B,EACIE,UAAUC,UAAV,CAAqBH,MAArB,EAA6B9B,SAAS+B,OAAT,CAAiBD,MAAjB,EAAyB,MAAzB,CAA7B,EADJ,KAGIE,UAAUC,UAAV,CAAqBH,MAArB;AACP;AACJ,KAlED;AAmEH,CApED;;AAsEA,SAASI,OAAT,GAAmB;AACf,QAAI/B,MAAMJ,EAAE,cAAF,EAAkBK,GAAlB,EAAV;;AAEA,QAAGD,IAAIE,IAAJ,GAAWC,MAAX,KAAsB,CAAzB,EAA4B;AACxBH,cAAM,UAAN;AACAJ,UAAE,cAAF,EAAkBK,GAAlB,CAAsBD,GAAtB;AACH;;AAEDJ,MAAE,eAAF,EAAmBoC,MAAnB;;AAEA,QAAIC,WAAWrC,EAAE,wBAAF,EAA4BsC,IAA5B,EAAf;;AAEArC,aAASG,GAAT,CAAaA,GAAb,EAAkBD,IAAlB,CAAuB,UAASoC,OAAT,EAAkB;;AAErC,YAAIC,OAAOC,OAAOD,IAAP,CAAYD,OAAZ,CAAX;AACAC,aAAKE,IAAL,CAAU,UAASC,CAAT,EAAYC,CAAZ,EAAe;AACrB,gBAAI/B,IAAI0B,QAAQI,CAAR,EAAWE,OAAX,CAAmBnC,KAAnB,CAAyB,OAAzB,CAAR;AACAiC,gBAAI,IAAIG,IAAJ,CAASjC,EAAE,CAAF,CAAT,EAAeA,EAAE,CAAF,IAAO,CAAtB,EAAyBA,EAAE,CAAF,CAAzB,EAA+BA,EAAE,CAAF,CAA/B,EAAqCA,EAAE,CAAF,CAArC,EAA2CA,EAAE,CAAF,CAA3C,CAAJ;AACAA,gBAAI0B,QAAQK,CAAR,EAAWC,OAAX,CAAmBnC,KAAnB,CAAyB,OAAzB,CAAJ;AACAkC,gBAAI,IAAIE,IAAJ,CAASjC,EAAE,CAAF,CAAT,EAAeA,EAAE,CAAF,IAAO,CAAtB,EAAyBA,EAAE,CAAF,CAAzB,EAA+BA,EAAE,CAAF,CAA/B,EAAqCA,EAAE,CAAF,CAArC,EAA2CA,EAAE,CAAF,CAA3C,CAAJ;;AAEA,mBAAQ8B,IAAIC,CAAL,GAAU,CAAC,CAAX,GAAgBD,IAAIC,CAAL,GAAU,CAAV,GAAc,CAApC;AACH,SAPD;;AASA,YAAGxC,QAAQ,UAAX,EAAuBJ,EAAE,8BAAF,EAAkCQ,IAAlC,CAAuC,eAAegC,KAAKjC,MAApB,GAA6B,GAApE,EAAvB,KACKP,EAAE,8BAAF,EAAkCQ,IAAlC,CAAuC,cAAcgC,KAAKjC,MAAnB,GAA4B,GAAnE;;AAEL,YAAGiC,KAAKjC,MAAL,KAAgB,CAAnB,EAAsB;AAClB,gBAAIU,IAAI,CAAR;AACA,gBAAI8B,UAAUC,YAAY,YAAY;AAClC,oBAAIC,QAAQV,QAAQC,KAAKvB,CAAL,CAAR,CAAZ;;AAEA,oBAAI0B,IAAI,IAAIO,YAAJ,CAAiBD,KAAjB,CAAR;AACAN,kBAAEQ,GAAF,CAAMC,MAAN;;AAEA,oBAAIZ,KAAK,EAAEvB,CAAP,MAAcoC,SAAlB,EAA6BC,cAAcP,OAAd;AAChC,aAPa,EAOX,EAPW,CAAd;;AASA,gBAAG3C,QAAQ,UAAX,EAAuBmD,iBAAiBnD,GAAjB,IAAwBmD,iBAAiB,EAAjB,CAAxB;AACvBvD,cAAE,iBAAF,EAAqBQ,IAArB,CAA0B,EAA1B,EAA8BgD,OAA9B,CAAsC;AAClCC,6BAAa,qBAAqBrD,GADA;AAElCsD,mCAAmB,WAFe;AAGlCC,sBAAM,CAAC,aAAD,EAAgBC,MAAhB,CAAuBL,iBAAiBnD,GAAjB,CAAvB;AAH4B,aAAtC;AAKH;;AAEDiC,iBAASP,IAAT;AACH,KAnCD;;AAqCA,WAAO,IAAP;AACH;;AAED,SAAS+B,UAAT,GAAsB;AAClB,QAAIzD,MAAMJ,EAAE,cAAF,EAAkBK,GAAlB,EAAV;AACAD,UAAMA,IAAI0D,OAAJ,CAAY,IAAZ,EAAkB,GAAlB,EAAuBA,OAAvB,CAA+B,KAA/B,EAAsC,IAAtC,CAAN;;AAEA,QAAIC,SAAS/D,EAAE,iBAAF,EAAqBK,GAArB,EAAb;;AAEAL,MAAE,eAAF,EAAmB8B,IAAnB;;AAEA,QAAIiC,WAAW,aAAf,EAA8B;AAC1B/D,UAAE,uBAAuBI,GAAzB,EAA8BkC,IAA9B;AACH,KAFD,MAEO;AACHtC,UAAE,uBAAuBI,GAAvB,GAA6B,UAA7B,GAA0C2D,MAA5C,EAAoDzB,IAApD;AACH;;AAED;;AAEA,WAAO,IAAP;AACH;;AAEDtC,EAAE,YAAW;AACTA,MAAEmC,OAAF;AACAnC,MAAE,cAAF,EAAkBgE,MAAlB,CAAyB7B,OAAzB;AACAnC,MAAE,iBAAF,EAAqBgE,MAArB,CAA4BH,UAA5B;AACH,CAJD;;AAMA,SAASI,UAAT,GAAsB;AAClBC,YAAQC,GAAR,CAAY,CAAZ;;AAEA,QAAIC,SAASpE,EAAE,cAAF,EAAkBK,GAAlB,EAAb;AACA,QAAIgE,QAAQrE,EAAE,qBAAF,EAAyBsE,IAAzB,CAA8B,OAA9B,CAAZ;;AAEA,QAAIF,WAAW,UAAf,EAA2B;AACvBpE,UAAE,uBAAF,EAA2B0C,IAA3B,CAAgC,UAAUC,CAAV,EAAaC,CAAb,EAAgB;AAC5CD,gBAAI4B,SAASvE,EAAE2C,CAAF,EAAK2B,IAAL,CAAU,IAAV,EAAgB5D,KAAhB,CAAsB,GAAtB,EAA2B,CAA3B,CAAT,EAAwC8D,YAA5C;AACA5B,gBAAI2B,SAASvE,EAAE4C,CAAF,EAAK0B,IAAL,CAAU,IAAV,EAAgB5D,KAAhB,CAAsB,GAAtB,EAA2B,CAA3B,CAAT,EAAwC8D,YAA5C;AACA,gBAAIH,UAAU,KAAd,EAAqB,OAAQ1B,IAAIC,CAAL,GAAU,CAAC,CAAX,GAAgBD,IAAIC,CAAL,GAAU,CAAV,GAAc,CAApC,CAArB,KACK,OAAQD,IAAIC,CAAL,GAAU,CAAV,GAAeD,IAAIC,CAAL,GAAU,CAAC,CAAX,GAAe,CAApC;AACR,SALD,EAKG6B,QALH,CAKY,cALZ;AAMH,KAPD,MAQK,IAAIL,WAAW,WAAf,EAA4B;AAC7BpE,UAAE,uBAAF,EAA2B0C,IAA3B,CAAgC,UAAUC,CAAV,EAAaC,CAAb,EAAgB;AAC5CD,gBAAI4B,SAASvE,EAAE2C,CAAF,EAAK2B,IAAL,CAAU,IAAV,EAAgB5D,KAAhB,CAAsB,GAAtB,EAA2B,CAA3B,CAAT,EAAwCgE,aAA5C;AACA9B,gBAAI2B,SAASvE,EAAE4C,CAAF,EAAK0B,IAAL,CAAU,IAAV,EAAgB5D,KAAhB,CAAsB,GAAtB,EAA2B,CAA3B,CAAT,EAAwCgE,aAA5C;AACA,gBAAIL,UAAU,KAAd,EAAqB,OAAQ1B,IAAIC,CAAL,GAAU,CAAC,CAAX,GAAgBD,IAAIC,CAAL,GAAU,CAAV,GAAc,CAApC,CAArB,KACK,OAAQD,IAAIC,CAAL,GAAU,CAAV,GAAeD,IAAIC,CAAL,GAAU,CAAC,CAAX,GAAe,CAApC;AACR,SALD,EAKG6B,QALH,CAKY,cALZ;AAMH;;AAED,WAAO,IAAP;AACH;;AAED;AACAzE,EAAE,YAAW;AACTA,MAAE,cAAF,EAAkBgE,MAAlB,CAAyBC,UAAzB;AACAjE,MAAE,qBAAF,EAAyBgB,KAAzB,CAA+B,YAAY;AACvC,YAAIqD,QAAQrE,EAAE,IAAF,EAAQsE,IAAR,CAAa,OAAb,CAAZ;;AAEA,YAAID,UAAU,KAAd,EAAqBrE,EAAE,qBAAF,EAAyBsE,IAAzB,CAA8B,OAA9B,EAAuC,MAAvC,EAA+C9D,IAA/C,CAAoD,yCAApD,EAArB,KACKR,EAAE,qBAAF,EAAyBsE,IAAzB,CAA8B,OAA9B,EAAuC,KAAvC,EAA8C9D,IAA9C,CAAmD,wCAAnD;;AAELyD;AACH,KAPD;;AASA,WAAO,IAAP;AACH,CAZD","file":"library.js","sourcesContent":["// TODO: Write a more robust tag, authors retrieval system.\n\n$(function() {\n    mySpires.prepare().then(function() {\n        let tag = $(\"#filter-tags\").val();\n\n        if(tag.trim().length === 0) {\n            tag = \"Untagged\";\n            $(\"#filter-tags\").val(tag);\n        }\n\n        if(tag === \"Untagged\") {\n            $(\"#page-title h2\").html(\"Library\");\n        }\n        else {\n            let tagEx = tag.split(\"/\");\n\n            let subtitleLink = \"\";\n            let subtitle = \"<a href='?'>Library</a>\";\n            for(let t of tagEx) {\n                if(subtitleLink !== \"\") subtitleLink = subtitleLink + \"/\";\n                subtitleLink = subtitleLink + t;\n                subtitle = subtitle + \" / <a href='?tag=\" + subtitleLink + \"'>\" + t + \"</a>\";\n            }\n\n            $(\"#page-title\").removeClass(\"main-title\");\n            $(\"#page-title h2\").html(tagEx[tagEx.length - 1]);\n            $(\"#page-breadcrumb\").html(subtitle);\n\n            $(\"#parent-page-link\").toggleClass(\"fa-hdd-o fa-chevron-left\").click(function() {\n                let i = tag.lastIndexOf(\"/\");\n                switch(i) {\n                    case -1:\n                        window.location = \"?\";\n                        break;\n                    default:\n                        window.location = window.location = \"?tag=\" + tag.substring(0, i);\n                }\n            });\n        }\n\n        let subtags = jQuery.map(mySpires.taglist, function(t) {\n            if(tag === \"Untagged\") {\n                if(t.trim().length !== 0) return t.split(\"/\")[0];\n                else return false;\n            } else if(t.indexOf(tag + \"/\") === 0) {\n                let s = t.substr(tag.length + 1);\n                return tag + \"/\" + s.split(\"/\")[0];\n            } else {\n                return false;\n            }\n        });\n\n        subtags = jQuery.grep(subtags, function(t, i) {\n            if(t !== false && subtags.indexOf(t) === i) return true;\n        });\n\n        if(subtags.length === 0) $(\".subtags .type-header\").hide();\n        else if(tag === \"Untagged\") $(\".subtags .type-header h3\").html(\"Tags (\" + subtags.length + \")\");\n        else $(\".subtags .type-header h3\").html(\"Subtags (\" + subtags.length + \")\");\n\n        for(let i in subtags) {\n            let subtag = subtags[i];\n\n            if(mySpires.tagopts[subtag] && mySpires.tagopts[subtag][\"type\"])\n                subtagBox.loadSubtag(subtag, mySpires.tagopts[subtag][\"type\"]);\n            else\n                subtagBox.loadSubtag(subtag);\n        }\n    });\n});\n\nfunction tagShow() {\n    let tag = $(\"#filter-tags\").val();\n\n    if(tag.trim().length === 0) {\n        tag = \"Untagged\";\n        $(\"#filter-tags\").val(tag);\n    }\n\n    $(\"div.paper-box\").remove();\n\n    let $spinner = $(\".paper-spinner-wrapper\").show();\n\n    mySpires.tag(tag).then(function(records) {\n\n        let keys = Object.keys(records);\n        keys.sort(function(a, b) {\n            let t = records[a].updated.split(/[- :]/);\n            a = new Date(t[0], t[1] - 1, t[2], t[3], t[4], t[5]);\n            t = records[b].updated.split(/[- :]/);\n            b = new Date(t[0], t[1] - 1, t[2], t[3], t[4], t[5]);\n\n            return (a > b) ? -1 : (a < b) ? 1 : 0;\n        });\n\n        if(tag === \"Untagged\") $(\".paper-boxes .type-header h3\").html(\"Untagged (\" + keys.length + \")\");\n        else $(\".paper-boxes .type-header h3\").html(\"Records (\" + keys.length + \")\");\n\n        if(keys.length !== 0) {\n            let i = 0;\n            let trigger = setInterval(function () {\n                let entry = records[keys[i]];\n\n                let a = new mySpires_Box(entry);\n                a.box.fadeIn(); \n\n                if (keys[++i] === undefined) clearInterval(trigger);\n            }, 10);\n\n            if(tag === \"Untagged\") entryTagsAuthors[tag] = entryTagsAuthors[\"\"];\n            $(\"#filter-authors\").html(\"\").select2({\n                placeholder: 'Select an option' + tag,\n                containerCssClass: \"selectors\",\n                data: [\"All Authors\"].concat(entryTagsAuthors[tag])\n            });\n        }\n\n        $spinner.hide();\n    });\n\n    return true;\n}\n\nfunction authorShow() {\n    let tag = $(\"#filter-tags\").val();\n    tag = tag.replace(/ /g, \"_\").replace(/\\//g, \"__\");\n\n    let author = $(\"#filter-authors\").val();\n\n    $(\"div.paper-box\").hide();\n\n    if (author === \"All Authors\") {\n        $(\"div.paper-box.tag-\" + tag).show();\n    } else {\n        $(\"div.paper-box.tag-\" + tag + \".author-\" + author).show();\n    }\n\n    // sortPapers();\n\n    return true;\n}\n\n$(function() {\n    $(tagShow);\n    $(\"#filter-tags\").change(tagShow);\n    $(\"#filter-authors\").change(authorShow);\n});\n\nfunction sortPapers() {\n    console.log(1);\n\n    let method = $(\"#filter-sort\").val();\n    let order = $(\"#filter-sort-button\").attr(\"order\");\n\n    if (method === \"modified\") {\n        $('div.paper-box:visible').sort(function (a, b) {\n            a = entryBox[$(a).attr(\"id\").split(\"-\")[1]].modifiedDate;\n            b = entryBox[$(b).attr(\"id\").split(\"-\")[1]].modifiedDate;\n            if (order === \"asc\") return (a < b) ? -1 : (a > b) ? 1 : 0;\n            else return (a < b) ? 1 : (a > b) ? -1 : 0;\n        }).appendTo(\".paper-boxes\");\n    }\n    else if (method === \"published\") {\n        $('div.paper-box:visible').sort(function (a, b) {\n            a = entryBox[$(a).attr(\"id\").split(\"-\")[1]].publishedDate;\n            b = entryBox[$(b).attr(\"id\").split(\"-\")[1]].publishedDate;\n            if (order === \"asc\") return (a < b) ? -1 : (a > b) ? 1 : 0;\n            else return (a < b) ? 1 : (a > b) ? -1 : 0;\n        }).appendTo(\".paper-boxes\");\n    }\n\n    return true;\n}\n\n// $(sortPapers);\n$(function() {\n    $(\"#filter-sort\").change(sortPapers);\n    $(\"#filter-sort-button\").click(function () {\n        let order = $(this).attr(\"order\");\n\n        if (order === \"asc\") $(\"#filter-sort-button\").attr(\"order\", \"desc\").html(\"<i class='fa fa-sort-numeric-desc'></i>\");\n        else $(\"#filter-sort-button\").attr(\"order\", \"asc\").html(\"<i class='fa fa-sort-numeric-asc'></i>\");\n\n        sortPapers();\n    });\n\n    return true;\n});"]}